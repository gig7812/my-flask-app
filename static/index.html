<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>YouTube 키워드 검색</title>
<style>
  body{background:#0b1016;color:#d7e2ee;font-family:system-ui,Arial,sans-serif;margin:0}
  header{padding:22px 16px 10px;display:flex;gap:10px;align-items:center}
  h1{font-size:22px;margin:0}
  .pill{background:#16202a;border:1px solid #243242;color:#cfe9ff;border-radius:999px;padding:8px 14px;cursor:pointer}
  .pill.active{background:#1f3a56;border-color:#3e6b97}
  .bar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;padding:0 16px 14px}
  input,select,button{background:#13202b;border:1px solid #294152;color:#e8f2ff;border-radius:8px;padding:10px 12px}
  input{min-width:260px;flex:1}
  button.run{background:#2a66a1;border-color:#2f78c0}
  #note{color:#90a4b7;font-size:12px;margin:8px 16px}
  .card{margin:10px 16px;background:#111923;border:1px solid #1b2a3a;border-radius:12px;padding:10px;display:flex;gap:14px}
  .thumb{width:220px;aspect-ratio:16/9;object-fit:cover;border-radius:8px;background:#0d141c}
  .meta{display:flex;flex-direction:column;gap:6px}
  .title{font-size:18px}
  a.open{color:#9fd0ff;text-decoration:none;border-bottom:1px dotted #3e6b97}
  .chips{display:flex;gap:8px;flex-wrap:wrap}
</style>
</head>
<body>

<header>
  <h1>🔎 YouTube 키워드 검색</h1>
</header>

<div class="bar">
  <button class="pill" id="btnSearch">검색</button>
  <button class="pill active" id="btnTrend">실시간</button>
  <button class="pill" id="btnWeekly">주간</button>

  <select id="region">
    <option value="">글로벌(US)</option>
    <option value="KR">국내(KR)</option>
    <option value="JP">일본(JP)</option>
    <option value="US">미국(US)</option>
    <option value="GB">영국(GB)</option>
  </select>

  <select id="duration">
    <option value="any">전체</option>
    <option value="short">숏폼(&lt;=4m)</option>
    <option value="long">롱폼(&gt;4m)</option>
  </select>

  <input id="q" placeholder="예: 쇼핑 / AI / 드라마" />
  <label>기간(days):
    <input id="days" type="number" min="0" value="5" style="width:70px" />
  </label>
  <label>개수:
    <input id="max" type="number" min="1" max="50" value="50" style="width:70px" />
  </label>
  <button class="run" id="run">실행</button>
</div>

<div id="note"></div>
<div id="list"></div>

<script>
const $ = s => document.querySelector(s);
const btns = {search: $('#btnSearch'), trend: $('#btnTrend'), weekly: $('#btnWeekly')};
let mode = 'trending'; // trending | search | weekly

function setMode(m){
  mode = m;
  for (const k in btns) btns[k].classList.remove('active');
  if (m==='search') btns.search.classList.add('active');
  if (m==='trending') btns.trend.classList.add('active');
  if (m==='weekly') btns.weekly.classList.add('active');
  $('#note').textContent = '';
  $('#list').innerHTML = '';
}

btns.search.onclick  = ()=> setMode('search');
btns.trend.onclick   = ()=> setMode('trending');
btns.weekly.onclick  = ()=> setMode('weekly');

$('#run').onclick = async ()=>{
  const q = $('#q').value.trim();
  const region = $('#region').value;
  const duration = $('#duration').value;
  const days = parseInt($('#days').value||'0',10);
  const max = Math.min(50, Math.max(1, parseInt($('#max').value||'50',10)));

  let url = '';
  if (mode==='trending') {
    url = `/trending?region=${encodeURIComponent(region||'KR')}&max=${max}`;
  } else if (mode==='weekly') {
    const qs = new URLSearchParams({
      region: region || 'KR',
      q,
      duration,
      days: String(days || 7),
      max: String(max),
    });
    url = `/weekly?${qs.toString()}`;
  } else {
    // search
    const qs = new URLSearchParams({
      q,
      region: region,
      duration,
      days: String(days || 0),
      max: String(max),
    });
    url = `/search?${qs.toString()}`;
  }

  $('#note').textContent = '불러오는 중...';
  $('#list').innerHTML = '';
  try {
    const res = await fetch(url);
    const data = await res.json();

    if (data.error) {
      $('#note').textContent = 'API 오류: ' + (JSON.stringify(data.error));
      return;
    }
    $('#note').textContent = `결과 ${data.items.length}건 (최대 ${max}개)`;

    render(data.items||[]);
  } catch (e) {
    $('#note').textContent = '요청 실패: ' + e;
  }
};

function render(items){
  const list = $('#list');
  list.innerHTML = '';
  for (const v of items) {
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
      <img class="thumb" src="${v.thumb||''}" alt="">
      <div class="meta">
        <div class="title">${escapeHtml(v.title||'')}</div>
        <div class="chips">
          <span>채널: ${escapeHtml(v.channel||'')}</span>
          <span>업로드: ${escapeHtml(v.publishedAt||'')}</span>
          <span>조회수: ${Number(v.viewCount||0).toLocaleString()}</span>
          <a class="open" href="${v.url||'#'}" target="_blank" rel="noopener">영상 열기 ↗</a>
        </div>
      </div>
    `;
    list.appendChild(card);
  }
}

function escapeHtml(s){
  return (s||'').replace(/[&<>"']/g, c => ({
    '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
  }[c]));
}

// 초기: 실시간(국내) 50개
$('#region').value = 'KR';
$('#max').value = 50;
setMode('trending');
$('#run').click();
</script>
</body>
</html>
