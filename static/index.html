<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <title>YouTube í‚¤ì›Œë“œ ê²€ìƒ‰</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <style>
    body{background:#0b0f14;color:#e7eef7;font-family:system-ui,Arial,sans-serif;margin:0}
    .wrap{max-width:1100px;margin:26px auto;padding:0 16px}
    h1{font-weight:800;font-size:28px;margin:0 0 18px}
    .tabs{display:flex;gap:8px;margin-bottom:10px}
    .tabs button{background:#101722;border:1px solid #1f2a3a;color:#e7eef7;padding:8px 14px;border-radius:10px;cursor:pointer}
    .tabs button.active{background:#1c2738}
    .bar{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px}
    input,select{background:#0e1621;color:#e7eef7;border:1px solid #233149;padding:10px;border-radius:10px}
    .btn{background:#19314d;border:1px solid #2a4667;color:#d7e3f7;padding:10px 16px;border-radius:10px;cursor:pointer}
    .card{background:#0e1621;border:1px solid #1f2a3a;border-radius:12px;padding:12px;margin:10px 0}
    .row{display:flex;gap:12px}
    .thumb{width:168px;height:94px;background:#111;border-radius:8px;flex:0 0 168px;object-fit:cover}
    .title{font-size:16px;font-weight:700;margin:2px 0 8px}
    .meta{color:#9fb0c2;font-size:13px}
    .link{color:#9bd3ff;text-decoration:none}
  </style>
</head>
<body>
<div class="wrap">
  <h1>ğŸ” YouTube í‚¤ì›Œë“œ ê²€ìƒ‰</h1>

  <div class="tabs">
    <button id="tab-search" class="active">ê²€ìƒ‰</button>
    <button id="tab-weekly">ì£¼ê°„</button>
    <button id="tab-realtime">ì‹¤ì‹œê°„ ì¦ê°€ëŸ‰</button>
  </div>

  <div class="bar">
    <select id="region">
      <option value="">ê¸€ë¡œë²Œ(US)</option>
      <option value="KR" selected>êµ­ë‚´(KR)</option>
      <option value="US">US</option>
      <option value="JP">JP</option>
      <option value="GB">GB</option>
    </select>

    <select id="duration">
      <option value="any" selected>ì „ì²´</option>
      <option value="short">ìˆí¼(YouTube ê¸°ì¤€)</option>
      <option value="long">ë¡±í¼(YouTube ê¸°ì¤€)</option>
    </select>

    <input id="q" placeholder="ì˜ˆ: ì‡¼í•‘ / AI / ë“œë¼ë§ˆ" style="flex:1"/>

    <input id="days" type="number" min="0" max="365" value="5" title="ê¸°ê°„(ì¼) â€“ 0ì€ ì œí•œì—†ìŒ"/>
    <input id="max" type="number" min="1" max="50" value="50" title="ê°œìˆ˜(ìµœëŒ€50)"/>

    <input id="window" type="number" min="5" max="360" value="60" title="ì‹¤ì‹œê°„ ì¦ê°€ëŸ‰: ì§€ë‚œ Në¶„"/>

    <button class="btn" id="btn-run">ì‹¤í–‰</button>
  </div>

  <div id="note" class="meta" style="margin:6px 0 12px"></div>
  <div id="list"></div>
</div>

<script>
let mode = "search"; // search | weekly | realtime

document.getElementById('tab-search').onclick = () => { mode='search'; setActive(); };
document.getElementById('tab-weekly').onclick = () => { mode='weekly'; setActive(); };
document.getElementById('tab-realtime').onclick = () => { mode='realtime'; setActive(); };

function setActive(){
  for(const id of ['tab-search','tab-weekly','tab-realtime']){
    document.getElementById(id).classList.remove('active');
  }
  document.getElementById('tab-'+mode).classList.add('active');
  document.getElementById('note').textContent = '';
  document.getElementById('list').innerHTML = '';
}

document.getElementById('btn-run').onclick = async ()=>{
  const region   = document.getElementById('region').value.trim();
  const duration = document.getElementById('duration').value;
  const q        = document.getElementById('q').value.trim();
  const days     = parseInt(document.getElementById('days').value||'0',10);
  const max      = parseInt(document.getElementById('max').value||'50',10);
  const windowM  = parseInt(document.getElementById('window').value||'60',10);

  try{
    let url = '';
    if(mode==='search'){
      const params = new URLSearchParams({q, duration, max});
      if(region) params.set('region', region);
      if(days>0) params.set('days', String(days));
      url = `/search?${params.toString()}`;
    }else if(mode==='weekly'){
      const params = new URLSearchParams({q, duration, max, days:String(days||7)});
      if(region) params.set('region', region);
      url = `/weekly?${params.toString()}`;
    }else{ // realtime
      const params = new URLSearchParams({window:String(windowM), max});
      params.set('region', region || 'KR');
      url = `/realtime?${params.toString()}`;
    }

    const res = await fetch(url);
    const data = await res.json();
    render(data.items || []);
  }catch(e){
    document.getElementById('note').textContent = 'ì—ëŸ¬: ' + e.message;
  }
};

function render(items){
  const list = document.getElementById('list');
  list.innerHTML = '';
  if(!items.length){
    document.getElementById('note').textContent = 'ê²°ê³¼ 0ê±´ (ìµœëŒ€ 50ê°œ)';
    return;
  }
  document.getElementById('note').textContent = `ê²°ê³¼ ${items.length}ê±´ (ìµœëŒ€ 50ê°œ)`;
  for(const it of items){
    const el = document.createElement('div');
    el.className = 'card';
    el.innerHTML = `
      <div class="row">
        <img class="thumb" src="${it.thumb || ''}" alt="">
        <div>
          <div class="title">${escapeHtml(it.title||'')}</div>
          <div class="meta">
            ì±„ë„: ${escapeHtml(it.channel||'')} 
            ${it.viewCount!=null ? `Â· ì¡°íšŒìˆ˜: ${n(it.viewCount)}` : ''}
            ${it.delta!=null ? `Â· ì¦ê°€ëŸ‰(ìµœê·¼): +${n(it.delta)}` : ''}
          </div>
          <div class="meta">
            <a class="link" href="${it.url}" target="_blank">ì˜ìƒ ì—´ê¸° â†—</a>
          </div>
        </div>
      </div>
    `;
    list.appendChild(el);
  }
}

function n(x){ try{ return Number(x).toLocaleString('ko-KR'); }catch{ return x; } }
function escapeHtml(s){ return (s||'').replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c])); }
</script>
</body>
</html>
