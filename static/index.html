<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>YouTube í‚¤ì›Œë“œ/ë­í‚¹ ëŒ€ì‹œë³´ë“œ</title>
  <style>
    :root{
      --bg:#0b1218; --panel:#0f1821; --line:#1b2a36; --muted:#8ba0b0;
      --fg:#e6eef6; --accent:#0ea5e9; --chip:#12202b; --chipline:#1c2b38;
    }
    *{box-sizing:border-box}
    body{background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:0}
    .wrap{max-width:1080px;margin:28px auto;padding:0 16px}
    h1{margin:0 0 16px;display:flex;gap:10px;align-items:center;font-size:28px;color:#bfe3ff}
    .tabs{display:flex;gap:8px;margin:12px 0 18px}
    .tabs button{background:var(--chip);border:1px solid var(--chipline);color:var(--fg);padding:8px 12px;border-radius:10px;cursor:pointer}
    .tabs button.active{background:var(--accent);border-color:var(--accent);color:#07131a;font-weight:700}
    .bar{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:12px}
    input,select,button{background:#0f1520;border:1px solid #2a3347;color:var(--fg);padding:10px 12px;border-radius:10px}
    input[type="number"]{width:90px}
    button.primary{background:var(--accent);border-color:var(--accent);color:#061017;font-weight:700;cursor:pointer}
    .muted{color:var(--muted);font-size:12px}
    #note{margin:6px 0 10px}
    #err .box{white-space:pre-wrap;word-break:break-all;background:#2a0f13;border:1px solid #7a2730;color:#ffd6d6;padding:10px;border-radius:8px}
    .grid{display:grid;gap:12px}
    .card{display:grid;grid-template-columns:160px auto;gap:12px;background:var(--panel);border:1px solid var(--line);border-radius:12px;overflow:hidden}
    .thumb{width:160px;height:90px;object-fit:cover;background:#0b1218}
    .meta{padding:10px;display:flex;flex-direction:column;gap:8px}
    .title{font-size:16px;font-weight:800;line-height:1.35}
    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap;font-size:13px;color:#a8bed0}
    .row a{color:#9bd3ff;text-decoration:none}
    .chip{background:var(--chip);border:1px solid var(--chipline);border-radius:999px;padding:3px 10px}
    .delta{background:#12321f;border-color:#1f6a3c;color:#a8f0c4}
    .hint{margin:4px 0 14px}
    .hide{display:none !important}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>ğŸ” YouTube í‚¤ì›Œë“œ/ë­í‚¹ ëŒ€ì‹œë³´ë“œ</h1>

    <!-- ëª¨ë“œ íƒ­ -->
    <div class="tabs" id="tabs">
      <button data-mode="search"   class="active">ê²€ìƒ‰</button>
      <button data-mode="trending">ì‹¤ì‹œê°„(ìœ íŠœë¸Œ)</button>
      <button data-mode="weekly">ì£¼ê°„</button>
      <button data-mode="realtime">ì‹¤ì‹œê°„(ì¦ê°€ëŸ‰)</button>
    </div>

    <!-- ì˜µì…˜ ë°” -->
    <div class="bar">
      <input id="q" placeholder="í‚¤ì›Œë“œ (ì˜ˆ: ì •ì¹˜ / ë“œë¼ë§ˆ / AI)" style="flex:1 1 360px">
      <select id="region">
        <option value="">ê¸€ë¡œë²Œ(US)</option>
        <option value="KR" selected>êµ­ë‚´(KR)</option>
        <option value="US">ë¯¸êµ­(US)</option>
        <option value="JP">ì¼ë³¸(JP)</option>
        <option value="IN">ì¸ë„(IN)</option>
        <option value="GB">ì˜êµ­(GB)</option>
      </select>
      <select id="duration">
        <!-- YouTube API í‘œì¤€: short<4ë¶„, medium 4~20ë¶„, long>20ë¶„ -->
        <option value="any" selected>ê¸¸ì´: ì „ì²´</option>
        <option value="short">ì§§ìŒ (&lt;4ë¶„)</option>
        <option value="medium">ì¤‘ê°„ (4~20ë¶„)</option>
        <option value="long">ê¹€ (&gt;20ë¶„)</option>
      </select>

      <!-- ê¸°ê°„/ìœˆë„/ê°œìˆ˜ -->
      <span id="label-days" class="muted">ê¸°ê°„(days)</span>
      <input id="days" type="number" min="1" max="30" value="5" title="ê²€ìƒ‰/ì£¼ê°„ì—ì„œ ì‚¬ìš©">

      <span id="label-window" class="muted hide">ìœˆë„(ë¶„)</span>
      <input id="window" type="number" min="5" max="1440" value="60" class="hide" title="ì‹¤ì‹œê°„(ì¦ê°€ëŸ‰)ì—ì„œ ì‚¬ìš©">

      <span class="muted">ê°œìˆ˜</span>
      <input id="max" type="number" min="1" max="50" value="50">

      <button id="go" class="primary">ì‹¤í–‰</button>
    </div>

    <div id="hint" class="muted hint">ê²€ìƒ‰: ìµœê·¼ 5ì¼ + ì¡°íšŒìˆ˜ìˆœ (daysë¡œ ì¡°ì ˆ). ì‹¤ì‹œê°„(ì¦ê°€ëŸ‰)ì€ ìµœê·¼ 60ë¶„ ì¦ê°€ëŸ‰ ê¸°ì¤€.</div>

    <div id="note" class="muted"></div>
    <div id="err"></div>

    <div id="list" class="grid"></div>
  </div>

  <script>
    // ===== helpers =====
    const $ = s => document.querySelector(s);
    const nf = new Intl.NumberFormat("ko-KR");
    function esc(s){ return (s||"").replace(/[&<>"]/g, c=>({ "&":"&amp;","<":"&lt;",">":"&gt;" }[c])); }
    function show(el, on){ el.classList.toggle("hide", !on); }
    function setModeUI(mode){
      // íƒ­ í‘œì‹œ
      [...$("#tabs").children].forEach(b=>b.classList.toggle("active", b.dataset.mode===mode));
      // ì…ë ¥ ê°€ì‹œì„±
      // ê²€ìƒ‰/ì£¼ê°„: days ì‚¬ìš© / ì‹¤ì‹œê°„(ìœ íŠœë¸Œ): days ìˆ¨ê¹€ / ì‹¤ì‹œê°„(ì¦ê°€ëŸ‰): window ì‚¬ìš©
      show($("#label-days"), mode==="search" || mode==="weekly");
      show($("#days"),       mode==="search" || mode==="weekly");

      const realtime = (mode==="realtime");
      show($("#label-window"), realtime);
      show($("#window"), realtime);

      // ê²€ìƒ‰/ì£¼ê°„ì€ í‚¤ì›Œë“œ ì˜µì…˜ ìœ íš¨, ì‹¤ì‹œê°„(ìœ íŠœë¸Œ/ì¦ê°€ëŸ‰)ì—ì„œëŠ” ì„ íƒì‚¬í•­
      $("#hint").textContent =
        mode==="search"  ? "ê²€ìƒ‰: ìµœê·¼ daysì¼ + ì¡°íšŒìˆ˜ìˆœ. duration=short/medium/long ì„ íƒ ê°€ëŠ¥."
      : mode==="weekly"  ? "ì£¼ê°„: ìµœê·¼ daysì¼(ê¸°ë³¸ 7) + ì¡°íšŒìˆ˜ìˆœ."
      : mode==="trending"? "ì‹¤ì‹œê°„(ìœ íŠœë¸Œ): êµ­ê°€ë³„ mostPopular. duration/ê¸°ê°„ í•„í„° ë¯¸ì§€ì›."
      : "ì‹¤ì‹œê°„(ì¦ê°€ëŸ‰): ìµœê·¼ windowë¶„ ì¡°íšŒìˆ˜ ì¦ê°€ëŸ‰ ê¸°ì¤€(ìˆ˜ì§‘ ì¡ í•„ìš”).";
    }

    // ===== state =====
    let mode = "search"; // search | trending | weekly | realtime
    setModeUI(mode);

    // íƒ­ í•¸ë“¤ë§
    $("#tabs").addEventListener("click", e=>{
      if(e.target.tagName!=="BUTTON") return;
      mode = e.target.dataset.mode;
      setModeUI(mode);
      $("#note").textContent = "";
      $("#err").innerHTML = "";
      $("#list").innerHTML = "";
      // ëª¨ë“œ ì „í™˜ì‹œ ê¸°ë³¸ê°’ ë³´ì •
      if(mode==="weekly" && !$("#days").value) $("#days").value = 7;
      if(mode==="search" && !$("#days").value) $("#days").value = 5;
    });

    // ì‹¤í–‰
    $("#go").addEventListener("click", run);
    $("#q").addEventListener("keydown", e=>{ if(e.key==="Enter") run(); });

    async function run(){
      $("#err").innerHTML = ""; $("#list").innerHTML = "";
      const q   = $("#q").value.trim();
      const reg = $("#region").value.trim();
      const dur = $("#duration").value;   // any|short|medium|long
      const max = Math.min(50, Math.max(1, parseInt($("#max").value||"50",10)));
      const days= Math.min(30, Math.max(1, parseInt($("#days").value||"5",10)));
      const win = Math.min(1440, Math.max(5, parseInt($("#window").value||"60",10)));

      let url="", title="";
      if(mode==="search"){
        if(!q){ $("#err").innerHTML = `<div class="box">ê²€ìƒ‰ì–´(q)ê°€ í•„ìš”í•©ë‹ˆë‹¤.</div>`; return; }
        const p = new URLSearchParams({ q, max, days, duration: dur });
        if(reg) p.set("region", reg);
        url = "/search?" + p.toString();
        title = `ê²€ìƒ‰ Â· ìµœê·¼ ${days}ì¼ Â· ${max}ê°œ`;
      } else if(mode==="trending"){
        const p = new URLSearchParams({ max });
        if(reg) p.set("region", reg);
        url = "/trending?" + p.toString();
        title = `ì‹¤ì‹œê°„(ìœ íŠœë¸Œ) Â· ${reg||"ê¸€ë¡œë²Œ"} Â· ${max}ê°œ`;
      } else if(mode==="weekly"){
        const p = new URLSearchParams({ max, days, duration: dur });
        if(q)   p.set("q", q);
        if(reg) p.set("region", reg);
        url = "/weekly?" + p.toString();
        title = `ì£¼ê°„ Â· ìµœê·¼ ${days}ì¼ Â· ${reg||"ê¸€ë¡œë²Œ"} Â· ${max}ê°œ`;
      } else { // realtime (ì¦ê°€ëŸ‰)
        const p = new URLSearchParams({ max, window: win });
        if(reg) p.set("region", reg);
        url = "/realtime?" + p.toString();
        title = `ì‹¤ì‹œê°„(ì¦ê°€ëŸ‰) Â· ìµœê·¼ ${win}ë¶„ Â· ${reg||"ê¸€ë¡œë²Œ"} Â· ${max}ê°œ`;
      }

      $("#note").textContent = title + " â€¦ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘";
      try{
        const res = await fetch(url, { headers: { "Accept":"application/json" }});
        const text = await res.text();
        let data;
        try { data = JSON.parse(text); }
        catch(e){ $("#err").innerHTML = `<div class="box">ì„œë²„ê°€ JSONì´ ì•„ë‹Œ ì‘ë‹µì„ ë³´ëƒˆìŠµë‹ˆë‹¤.\n\n${esc(text)}</div>`; $("#note").textContent=""; return; }

        const items = Array.isArray(data.items) ? data.items : [];
        render(items);
        $("#note").textContent = `${title} â€” ê²°ê³¼ ${items.length}ê±´`;
      }catch(err){
        $("#err").innerHTML = `<div class="box">${esc(String(err))}</div>`;
        $("#note").textContent = "";
      }
    }

    function render(items){
      const box = $("#list");
      if(!items.length){ box.innerHTML = `<div class="muted">ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`; return; }
      box.innerHTML = items.map(it=>{
        const delta = (typeof it.delta==="number" && it.delta>0) ? `<span class="chip delta">+${nf.format(it.delta)}</span>` : "";
        return `
          <div class="card">
            <img class="thumb" src="${esc(it.thumb||"")}" alt="">
            <div class="meta">
              <div class="title">${esc(it.title||"")}</div>
              <div class="row">
                <span class="chip">${esc(it.channel||"")}</span>
                ${delta}
                <span class="chip">ì¡°íšŒìˆ˜ ${nf.format(it.viewCount||0)}</span>
                ${it.publishedAt? `<span class="chip">${new Date(it.publishedAt).toLocaleString("ko-KR")}</span>` : ""}
                ${it.url? `<a class="chip" href="${esc(it.url)}" target="_blank" rel="noopener">ì˜ìƒ ì—´ê¸° â†—</a>` : ""}
              </div>
            </div>
          </div>`;
      }).join("");
    }
  </script>
</body>
</html>
