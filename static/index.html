<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <title>YouTube 키워드 검색</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <style>
    body{background:#0b0f14;color:#e7eef7;font-family:system-ui,Arial,sans-serif;margin:0}
    .wrap{max-width:1100px;margin:26px auto;padding:0 16px}
    h1{font-weight:800;font-size:28px;margin:0 0 18px}
    .tabs{display:flex;gap:8px;margin-bottom:10px}
    .tabs button{background:#101722;border:1px solid #1f2a3a;color:#e7eef7;padding:8px 14px;border-radius:10px;cursor:pointer}
    .tabs button.active{background:#1c2738}
    .bar{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px}
    input,select{background:#0e1621;color:#e7eef7;border:1px solid #233149;padding:10px;border-radius:10px}
    .btn{background:#19314d;border:1px solid #2a4667;color:#d7e3f7;padding:10px 16px;border-radius:10px;cursor:pointer}
    .card{background:#0e1621;border:1px solid #1f2a3a;border-radius:12px;padding:12px;margin:10px 0}
    .row{display:flex;gap:12px}
    .thumb{width:168px;height:94px;background:#111;border-radius:8px;flex:0 0 168px;object-fit:cover}
    .title{font-size:16px;font-weight:700;margin:2px 0 8px}
    .meta{color:#9fb0c2;font-size:13px}
    .link{color:#9bd3ff;text-decoration:none}
  </style>
</head>
<body>
<div class="wrap">
  <h1>🔎 YouTube 키워드 검색</h1>

  <div class="tabs">
    <button id="tab-search" class="active">검색</button>
    <button id="tab-weekly">주간</button>
    <button id="tab-realtime">실시간 증가량</button>
  </div>

  <div class="bar">
    <select id="region">
      <option value="">글로벌(US)</option>
      <option value="KR" selected>국내(KR)</option>
      <option value="US">US</option>
      <option value="JP">JP</option>
      <option value="GB">GB</option>
    </select>

    <select id="duration">
      <option value="any" selected>전체</option>
      <option value="short">숏폼(YouTube 기준)</option>
      <option value="long">롱폼(YouTube 기준)</option>
    </select>

    <input id="q" placeholder="예: 쇼핑 / AI / 드라마" style="flex:1"/>

    <input id="days" type="number" min="0" max="365" value="5" title="기간(일) – 0은 제한없음"/>
    <input id="max" type="number" min="1" max="50" value="50" title="개수(최대50)"/>

    <input id="window" type="number" min="5" max="360" value="60" title="실시간 증가량: 지난 N분"/>

    <button class="btn" id="btn-run">실행</button>
  </div>

  <div id="note" class="meta" style="margin:6px 0 12px"></div>
  <div id="list"></div>
</div>

<script>
let mode = "search"; // search | weekly | realtime

document.getElementById('tab-search').onclick = () => { mode='search'; setActive(); };
document.getElementById('tab-weekly').onclick = () => { mode='weekly'; setActive(); };
document.getElementById('tab-realtime').onclick = () => { mode='realtime'; setActive(); };

function setActive(){
  for(const id of ['tab-search','tab-weekly','tab-realtime']){
    document.getElementById(id).classList.remove('active');
  }
  document.getElementById('tab-'+mode).classList.add('active');
  document.getElementById('note').textContent = '';
  document.getElementById('list').innerHTML = '';
}

document.getElementById('btn-run').onclick = async ()=>{
  const region   = document.getElementById('region').value.trim();
  const duration = document.getElementById('duration').value;
  const q        = document.getElementById('q').value.trim();
  const days     = parseInt(document.getElementById('days').value||'0',10);
  const max      = parseInt(document.getElementById('max').value||'50',10);
  const windowM  = parseInt(document.getElementById('window').value||'60',10);

  try{
    let url = '';
    if(mode==='search'){
      const params = new URLSearchParams({q, duration, max});
      if(region) params.set('region', region);
      if(days>0) params.set('days', String(days));
      url = `/search?${params.toString()}`;
    }else if(mode==='weekly'){
      const params = new URLSearchParams({q, duration, max, days:String(days||7)});
      if(region) params.set('region', region);
      url = `/weekly?${params.toString()}`;
    }else{ // realtime
      const params = new URLSearchParams({window:String(windowM), max});
      params.set('region', region || 'KR');
      url = `/realtime?${params.toString()}`;
    }

    const res = await fetch(url);
    const data = await res.json();
    render(data.items || []);
  }catch(e){
    document.getElementById('note').textContent = '에러: ' + e.message;
  }
};

function render(items){
  const list = document.getElementById('list');
  list.innerHTML = '';
  if(!items.length){
    document.getElementById('note').textContent = '결과 0건 (최대 50개)';
    return;
  }
  document.getElementById('note').textContent = `결과 ${items.length}건 (최대 50개)`;
  for(const it of items){
    const el = document.createElement('div');
    el.className = 'card';
    el.innerHTML = `
      <div class="row">
        <img class="thumb" src="${it.thumb || ''}" alt="">
        <div>
          <div class="title">${escapeHtml(it.title||'')}</div>
          <div class="meta">
            채널: ${escapeHtml(it.channel||'')} 
            ${it.viewCount!=null ? `· 조회수: ${n(it.viewCount)}` : ''}
            ${it.delta!=null ? `· 증가량(최근): +${n(it.delta)}` : ''}
          </div>
          <div class="meta">
            <a class="link" href="${it.url}" target="_blank">영상 열기 ↗</a>
          </div>
        </div>
      </div>
    `;
    list.appendChild(el);
  }
}

function n(x){ try{ return Number(x).toLocaleString('ko-KR'); }catch{ return x; } }
function escapeHtml(s){ return (s||'').replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c])); }
</script>
</body>
</html>
