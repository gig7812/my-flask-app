<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>YouTube í‚¤ì›Œë“œ ê²€ìƒ‰</title>
  <style>
    body { background:#0b1218; color:#dfe6ee; font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial; margin:0; }
    .wrap { max-width:1080px; margin:28px auto; padding:0 16px; }
    h1 { font-size:28px; margin:0 0 16px 0; display:flex; gap:8px; align-items:center; }
    .pill { display:inline-flex; gap:8px; margin:12px 0 20px 0; }
    .pill button { background:#12202b; color:#dfe6ee; border:1px solid #1c2b38; padding:8px 12px;
                   border-radius:10px; cursor:pointer; }
    .pill button.active { background:#0ea5e9; border-color:#0ea5e9; color:#061017; }
    .bar { display:flex; flex-wrap:wrap; gap:8px; margin-bottom:16px; }
    input, select { background:#0f1a22; border:1px solid #1c2b38; color:#dfe6ee;
                    padding:10px 12px; border-radius:10px; }
    input[type="number"] { width:80px; }
    #go { background:#0ea5e9; border: none; color: #061017; font-weight:600; }
    .muted { color:#7d8b99; font-size:12px; }
    .grid { display:grid; gap:12px; }
    .card { display:grid; grid-template-columns:160px auto; gap:12px; background:#0f1821; border:1px solid #1b2a36; border-radius:12px; overflow:hidden; }
    .thumb { width:160px; height:90px; object-fit:cover; display:block; background:#0b1218; }
    .meta { padding:10px 10px; display:flex; flex-direction:column; gap:6px; }
    .title { font-size:16px; font-weight:700; line-height:1.3; }
    .row { display:flex; gap:14px; align-items:center; flex-wrap:wrap; font-size:13px; color:#9eb1c1; }
    .row a { color:#9bd3ff; text-decoration:none; }
    #note { margin:10px 0; }
    .err { color:#ffb4b4; white-space:pre-wrap; word-break:break-all; background:#2a0f13; border:1px solid #7a2730; padding:10px; border-radius:8px; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>ğŸ” YouTube í‚¤ì›Œë“œ ê²€ìƒ‰</h1>

    <!-- ëª¨ë“œ íƒ­ -->
    <div class="pill" id="modes">
      <button data-mode="search" class="active">ê²€ìƒ‰</button>
      <button data-mode="trending">ì‹¤ì‹œê°„</button>
      <button data-mode="weekly">ì£¼ê°„</button>
    </div>

    <!-- ì˜µì…˜ ë°” -->
    <div class="bar">
      <input id="q" placeholder="ì˜ˆ: ì‡¼í•‘ / AI / ë“œë¼ë§ˆ" style="flex:1 1 360px" />
      <select id="region">
        <option value="">ê¸€ë¡œë²Œ(US)</option>
        <option value="KR">êµ­ë‚´(KR)</option>
        <option value="US">ë¯¸êµ­(US)</option>
        <option value="JP">ì¼ë³¸(JP)</option>
        <option value="IN">ì¸ë„(IN)</option>
        <option value="GB">ì˜êµ­(GB)</option>
      </select>
      <select id="duration">
        <option value="any">ì „ì²´</option>
        <option value="short">ì§§ìŒ (&lt;4ë¶„)</option>
        <option value="medium">ì¤‘ê°„ (4~20ë¶„)</option>
        <option value="long">ê¹€ (&gt;20ë¶„)</option>
      </select>
      <label class="muted">ê¸°ê°„(days)</label>
      <input id="days" type="number" min="1" value="5" />
      <label class="muted">ê°œìˆ˜</label>
      <input id="max" type="number" min="1" max="50" value="10" />
      <button id="go">ì‹¤í–‰</button>
    </div>

    <div id="note" class="muted"></div>
    <div id="err"></div>

    <div id="list" class="grid"></div>

  </div>

  <script>
    const $ = s => document.querySelector(s);
    const modes = $("#modes");
    let currentMode = "search"; // ê¸°ë³¸ ê²€ìƒ‰

    // ëª¨ë“œ íƒ­ í´ë¦­
    modes.addEventListener("click", (e) => {
      if (e.target.tagName !== "BUTTON") return;
      [...modes.children].forEach(b => b.classList.remove("active"));
      e.target.classList.add("active");
      currentMode = e.target.dataset.mode;
      // ëª¨ë“œì— ë”°ë¼ days ê¸°ë³¸ê°’ í‘œì‹œ ë³€ê²½ (ê²€ìƒ‰ 5ì¼, ì£¼ê°„ 7ì¼)
      if (currentMode === "weekly") $("#days").value = 7; else $("#days").value = 5;
      $("#note").textContent = "";
      $("#err").textContent = "";
      $("#list").innerHTML = "";
    });

    // ì‹¤í–‰ ë²„íŠ¼
    $("#go").addEventListener("click", async () => {
      $("#err").textContent = "";
      $("#list").innerHTML = "";
      const q = $("#q").value.trim();
      const region = $("#region").value.trim();
      const duration = $("#duration").value; // any|short|medium|long
      const days = Math.max(1, parseInt($("#days").value || "5", 10));
      const max = Math.min(50, Math.max(1, parseInt($("#max").value || "10", 10)));

      let url = "";
      let note = "";
      try {
        if (currentMode === "search") {
          if (!q) {
            $("#err").innerHTML = `<div class="err">ê²€ìƒ‰ì–´(q)ê°€ í•„ìš”í•©ë‹ˆë‹¤.</div>`;
            return;
          }
          const params = new URLSearchParams({ q, max, days, duration });
          if (region) params.set("region", region);
          url = "/search?" + params.toString();
          note = `ê²€ìƒ‰(ìµœê·¼ ${days}ì¼, ${max}ê°œ)`;
        } else if (currentMode === "trending") {
          const params = new URLSearchParams({ max });
          if (region) params.set("region", region);
          url = "/trending?" + params.toString();
          note = `ì‹¤ì‹œê°„ ì¸ê¸°(${region || "ê¸€ë¡œë²Œ"})`;
        } else if (currentMode === "weekly") {
          const params = new URLSearchParams({ max, days, duration });
          if (q) params.set("q", q);
          if (region) params.set("region", region);
          url = "/weekly?" + params.toString();
          note = `ì£¼ê°„ ë­í‚¹(ìµœê·¼ ${days}ì¼, ${max}ê°œ, ${region || "ê¸€ë¡œë²Œ"})`;
        }

        $("#note").textContent = note + " â€¦ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘";

        const res = await fetch(url, { headers: { "Accept": "application/json" }});
        const text = await res.text();

        // JSON íŒŒì‹± ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë³¸ë¬¸ ê·¸ëŒ€ë¡œ ë³´ì—¬ì£¼ê¸°
        let data;
        try {
          data = JSON.parse(text);
        } catch (e) {
          $("#err").innerHTML = `<div class="err">ì„œë²„ ì‘ë‹µì´ JSONì´ ì•„ë‹™ë‹ˆë‹¤.\n\n${text}</div>`;
          $("#note").textContent = "";
          return;
        }

        if (!data || !Array.isArray(data.items)) {
          $("#err").innerHTML = `<div class="err">API ì‘ë‹µ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>`;
          $("#note").textContent = "";
          return;
        }

        renderList(data.items);
        $("#note").textContent = `${note} â€“ ê²°ê³¼ ${data.items.length}ê±´`;
      } catch (err) {
        $("#err").innerHTML = `<div class="err">${String(err)}</div>`;
        $("#note").textContent = "";
      }
    });

    function renderList(items) {
      const box = $("#list");
      box.innerHTML = "";
      if (!items.length) {
        box.innerHTML = `<div class="muted">ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
        return;
      }
      for (const it of items) {
        const el = document.createElement("div");
        el.className = "card";
        el.innerHTML = `
          <img class="thumb" src="${it.thumb || ""}" alt="">
          <div class="meta">
            <div class="title">${escapeHtml(it.title || "")}</div>
            <div class="row">
              <span>ì±„ë„: ${escapeHtml(it.channel || "")}</span>
              <span>ì—…ë¡œë“œ: ${new Date(it.publishedAt || "").toLocaleString()}</span>
              <span>ì¡°íšŒìˆ˜: ${number(it.viewCount || 0)}</span>
              <a href="${it.url}" target="_blank" rel="noopener">ì˜ìƒ ì—´ê¸° â†—</a>
            </div>
          </div>
        `;
        box.appendChild(el);
      }
    }

    function number(n) {
      try { return (+n).toLocaleString(); } catch { return n; }
    }
    function escapeHtml(s) {
      return (s || "").replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));
    }
  </script>
</body>
</html>
